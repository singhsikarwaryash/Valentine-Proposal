(function(){
  const canvas = document.getElementById('confetti'); if(!canvas) return; const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  window.addEventListener('resize', resize); resize();
  function heart(x,y,size,rot,color){ ctx.save(); ctx.translate(x,y); ctx.rotate(rot); ctx.fillStyle=color; const s=size/2; ctx.beginPath(); ctx.moveTo(0,s); ctx.bezierCurveTo(0, s-s*.6, -s, s-s*.2, -s, 0); ctx.bezierCurveTo(-s, -s*.8, 0, -s*.8, 0, -s*.3); ctx.bezierCurveTo(0, -s*.8, s, -s*.8, s, 0); ctx.bezierCurveTo(s, s-s*.2, 0, s-s*.6, 0, s); ctx.closePath(); ctx.fill(); ctx.restore(); }
  function start(ms=5000){ const parts=[]; const colors=['#ff4d6d','#ff758f','#ff8fa3','#c9184a','#ffccd5','#ffa6c1','#ffb3c1','#f783ac','#ff85a1']; const count=Math.min(260, Math.floor((canvas.width*canvas.height)/12000)); for(let i=0;i<count;i++){ parts.push({x:Math.random()*canvas.width,y:-20,w:Math.random()*8+6,h:Math.random()*12+8,r:Math.random()*Math.PI,vX:(Math.random()-.5)*5,vY:Math.random()*3+3,rot:(Math.random()-.5)*.2,color:colors[Math.floor(Math.random()*colors.length)],shape:Math.random()<.25?'heart':'rect'});} canvas.classList.add('active'); const startT=performance.now(); function frame(now){ const t=now-startT; ctx.clearRect(0,0,canvas.width,canvas.height); parts.forEach(p=>{ p.x+=p.vX; p.y+=p.vY; p.r+=p.rot; if(p.y>canvas.height+20){ p.y=-20; p.x=Math.random()*canvas.width; } if(p.shape==='rect'){ ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r); ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); } else { heart(p.x,p.y,Math.max(p.w,p.h)+4,p.r,p.color); } }); if(t<ms){ requestAnimationFrame(frame); } else { canvas.classList.remove('active'); ctx.clearRect(0,0,canvas.width,canvas.height); } } requestAnimationFrame(frame); }
  window.ValentineConfetti = { start };
})();
